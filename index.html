<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vid2Beat â€“ Audio Extractor</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-dark:#0f0f0f; --text-dark:#00ff88;
    --bg-light:#f5f5f5; --text-light:#007f00;
    --accent-dark:#00ff88; --accent-light:#007f00;
  }
  body{
    font-family:'Share Tech Mono', monospace;
    margin:0;padding:18px;
    display:flex;flex-direction:column;align-items:center;
    background:var(--bg-dark);color:var(--text-dark);
  }
  body.light{background:var(--bg-light);color:var(--text-light);}
  h1{margin:0 0 12px 0;font-size:1.6rem;}
  button{padding:8px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700;margin:4px;}
  #dropArea{width:80%;max-width:720px;height:120px;border:2px dashed rgba(0,255,136,0.18);
    display:flex;align-items:center;justify-content:center;padding:12px;text-align:center;transition:all .15s;}
  #dropArea.drag{border-color:var(--accent-dark); transform:scale(1.01);}
  #progressContainer{width:80%;max-width:720px;height:16px;border-radius:10px;border:1px solid rgba(0,255,136,0.15);overflow:hidden;display:none;}
  #progressBar{height:100%;width:0%;background:var(--accent-dark);transition:width .12s linear;}
  body.light #progressBar{background:var(--accent-light);}
  audio{width:80%;max-width:720px;display:none;margin-top:6px;}
  #downloadLink{display:none;margin-top:6px;}
  #terminal{width:80%;max-width:720px;height:200px;border-radius:8px;padding:8px;background:#111;color:#0f0;overflow:auto;font-size:12px;white-space:pre-wrap;margin-top:6px;}
  body.light #terminal{background:#eee;color:#007f00;}
  footer{margin-top:10px;font-size:0.9rem;opacity:0.9;}
</style>
</head>
<body>

<h1>ðŸŽ§ Vid2Beat â€“ Audio Extractor</h1>

<div>
  <button id="themeBtn">Toggle Theme</button>
</div>

<div id="dropArea">Drop a video here or click to choose</div>
<input type="file" id="fileInput" accept="video/*" style="display:none">

<div id="progressContainer"><div id="progressBar"></div></div>
<a id="downloadLink" href="#" download="output.mp3">Download MP3</a>
<audio id="audioPlayer" controls></audio>
<div id="terminal" aria-live="polite"></div>
<footer>Made by Aryan</footer>

<script type="module">
import { createFFmpeg, fetchFile } from 'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.mjs';

const ffmpeg = createFFmpeg({ log: true });

const themeBtn = document.getElementById('themeBtn');
const dropArea = document.getElementById('dropArea');
const fileInput = document.getElementById('fileInput');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const audioPlayer = document.getElementById('audioPlayer');
const downloadLink = document.getElementById('downloadLink');
const terminal = document.getElementById('terminal');

let fileHandle = null;

// Terminal logger
function log(msg){ terminal.textContent += msg + '\n'; terminal.scrollTop = terminal.scrollHeight; }

// Theme
const savedTheme = document.cookie.split('; ').find(r=>r.startsWith('theme='))?.split('=')[1] || 'dark';
if(savedTheme==='light') document.body.classList.add('light');
themeBtn.onclick = ()=>{
  const light = document.body.classList.toggle('light');
  document.cookie = `theme=${light?'light':'dark'};path=/;max-age=31536000`;
  log(`Theme: ${light?'light':'dark'}`);
}

// Drag & drop
dropArea.addEventListener('dragover', e=>{ e.preventDefault(); dropArea.classList.add('drag'); });
dropArea.addEventListener('dragleave', ()=>dropArea.classList.remove('drag'));
dropArea.addEventListener('drop', e=>{ e.preventDefault(); dropArea.classList.remove('drag'); handleFile(e.dataTransfer.files[0]); });
dropArea.addEventListener('click', ()=>fileInput.click());
fileInput.addEventListener('change', e=>handleFile(e.target.files[0]));

function handleFile(file){
  if(!file) return;
  fileHandle = file;
  audioPlayer.style.display='none';
  downloadLink.style.display='none';
  progressContainer.style.display='block';
  progressBar.style.width='0%';
  log(`Selected: ${file.name} (${Math.round(file.size/1024)} KB)`);
  extractAudio();
}

// Extract audio
async function extractAudio(){
  if(!fileHandle) return log('No file selected!');
  log('Loading FFmpeg...');
  if(!ffmpeg.isLoaded()){ await ffmpeg.load(); log('FFmpeg loaded'); }
  try{
    ffmpeg.setProgress(({ratio})=>{ progressBar.style.width=Math.round(ratio*100)+'%'; });
    ffmpeg.setLogger(({type,message})=>{ log(`[${type}] ${message}`); });
    const inName = 'input.' + fileHandle.name.split('.').pop();
    const outName = 'output.mp3';
    ffmpeg.FS('writeFile', inName, await fetchFile(fileHandle));
    log('Extracting audio...');
    await ffmpeg.run('-i', inName, '-vn', '-q:a','0', outName);
    const data = ffmpeg.FS('readFile', outName);
    const blob = new Blob([data.buffer], {type:'audio/mp3'});
    const url = URL.createObjectURL(blob);
    audioPlayer.src=url; audioPlayer.style.display='block';
    downloadLink.href=url; downloadLink.style.display='inline-block';
    progressBar.style.width='100%';
    log('Extraction finished âœ…');
  }catch(err){
    log('ERROR: ' + err.message);
  }
}
</script>

</body>
  </html>
